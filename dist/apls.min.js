var Apls=function(){var version="0.30";if("undefined"!=typeof Amplitude){var pls,options={},plsShuffled=[],plsShuffledIndex=0,isContinuous,isPaused=!1,isPlayOne=!1,isRefreshDivs,isRepeat=!1,isShuffle;return document.addEventListener("keydown",function(e){switch(e.keyCode){case 37:Apls.playPrev();break;case 39:Apls.playNext()}}),{addSong:utilsAddNewTracks,continuous:setContinuous,init:init,isContinuous:getContinuous,isPaused:getPaused,isPlayOne:getPlayOne,isRepeat:getRepeat,isShuffle:getShuffle,pause:pause,playlist:getPlaylist,play:play,playNext:playNext,playNow:playNow,playOne:setPlayOne,playPrev:playPrev,plsShuffled:getPlsShuffled,stop:playStop,refreshDivs:setRefreshDivs,repeat:setRepeat,shuffle:setShuffle,ver:getVersion}}function init(playlist,opts={}){(pls=document.getElementById(playlist))?(clearSelected(),isRefreshDivs=opts.refreshDivs||!0,options.mainAlbum=opts.mainAlbum||"mainAlbum",options.mainSong=opts.mainSong||"mainSong",options.mainArtist=opts.mainArtist||"mainArtist",isContinuous=opts.continuous||!1,isPlayOne=opts.playOne||!1,(isShuffle=opts.shuffle||!1)&&setPlsShuffled(),opts.autoplay&&play()):console.log("Playlist not found")}function clearDivs(divs){var clear=divs.map(function(div){var d=document.getElementById(div);d&&(d.innerHTML="")})}function clearSelected(){var ctrl=pls.querySelectorAll(".selected"),len=ctrl.length;if(len>0)for(var i=0;i<len;i++)ctrl[i].classList.remove("selected")}function firePlayEnd(){var event=new Event("playEnd");document.dispatchEvent(event)}function getContinuous(){return isContinuous}function getPaused(){return isPaused}function getPlayOne(){return isPlayOne}function getPlsShuffled(){return plsShuffled}function getRepeat(){return isRepeat}function getShuffle(){return isShuffle}function getPlaylist(){return pls.id}function getVersion(){return version}function pause(){isPaused=!0,Amplitude.pause()}function play(track=""){if(track)if("object"==typeof track){var curTrack;pls.querySelector(".selected")&&clearSelected();var url=track.dataset.trackUrl;try{Amplitude.playNow({url:url}),track.classList.add("selected")}catch(err){return console.log("Can't play "+url+". Error: "+err.message),playNext()}isRefreshDivs&&refreshPlayDivs(track)}else console.log("Track not found");else isPaused?(Amplitude.play(),isPaused=!1):play(isShuffle?plsShuffled[0]:pls.children[0])}function playAgain(curTrack){var url=curTrack.dataset.trackUrl;Amplitude.playNow({url:url})}function playNext(){if(isPlayOne)return playStop();if(isShuffle)return playNextShuffled();var curTrack=pls.querySelector(".selected");if(!curTrack)return play(pls.children[0]);if(isRepeat)return playAgain(curTrack);var nextTrack=curTrack.nextElementSibling;nextTrack?play(nextTrack):isContinuous?play(pls.children[0]):100===Amplitude.getSongPlayedPercentage()&&(curTrack.classList.remove("selected"),firePlayEnd())}function playNextShuffled(){plsShuffledIndex<plsShuffled.length-1?play(plsShuffled[plsShuffledIndex+=1]):isContinuous?(setPlsShuffled(),play(plsShuffled[0])):100===Amplitude.getSongPlayedPercentage()&&(curTrack.classList.remove("selected"),firePlayEnd())}function playNow(id){var t=document.getElementById(id);t&&play(t)}function playPrev(){if(isShuffle)playPrevShuffled();else{var curTrack,prevTrack=pls.querySelector(".selected").previousElementSibling;prevTrack&&play(prevTrack)}}function playPrevShuffled(){plsShuffledIndex>0&&play(plsShuffled[plsShuffledIndex-=1])}function playStop(){Amplitude.getSongPlayedPercentage()&&(Amplitude.setSongPlayedPercentage(0),Amplitude.pause()),isRefreshDivs&&clearDivs([options.mainArtist,options.mainSong]),isShuffle&&setPlsShuffled()}function refreshPlayDivs(track){var artist=track.querySelector(".artist"),mainArtist=document.getElementById(options.mainArtist);artist&&mainArtist&&(mainArtist.innerHTML=artist.innerText);var song=track.querySelector(".song"),mainSong=document.getElementById(options.mainSong);song&&mainSong&&(mainSong.innerHTML=song.innerText);var album=track.dataset.album,mainAlbum=document.getElementById(options.mainAlbum);album&&mainAlbum&&(mainAlbum.src=album)}function setContinuous(){isContinuous=!isContinuous}function setPlayOne(){isPlayOne=!isPlayOne}function setRefreshDivs(bol){isRefreshDivs=bol}function setPlsShuffled(){var tracks=pls.getElementsByTagName("LI");tracks.length>0&&(plsShuffled=shuffleMe(plsShuffled=Array.from(tracks)),plsShuffledIndex=0)}function setRepeat(){isRepeat=!isRepeat}function setShuffle(){(isShuffle=!isShuffle)&&setPlsShuffled()}function shuffleMe(array){for(var currentIndex=array.length,temporaryValue,randomIndex;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),temporaryValue=array[currentIndex-=1],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}function utilsAddNewTracks(tracks){if(!Array.isArray(tracks))return console.log("Error: tracks must be an array"),!1;for(var tracksLen=tracks.length,i=0;i<tracksLen;i++)pls.innerHTML+=utilsCreateTrack(tracks[i])}function utilsCreateTrack(track){var track;return`<li ${(track=utilsSanitizeObj(track)).id&&""!==track.id.innerHTML?`id='${track.id.innerHTML}'`:""} data-track-url="${track.url.innerHTML}" ${track.album&&""!==track.album.innerHTML?`data-album='${track.album.innerHTML}'`:""} onclick="Apls.play(this)">\n\t\t            ${track.artist&&""!==track.artist.innerHTML?`<span class="artist">${track.artist.innerHTML}</span>`:""} ${track.song&&""!==track.song.innerHTML?` | <span class="song">${track.song.innerHTML}</span>`:""}\n\t\t\t\t </li>`}function utilsSanitizeObj(obj){var cleanObj={};for(prop in obj){var span=document.createElement("span");span.appendChild(document.createTextNode(obj[prop])),cleanObj[prop]=span}return cleanObj}console.log("Apls requires Amplitude.js to run.")}();
